<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>√Ålv√°nyos szolg√°lat</title>
  <link rel="icon" type="image/png" href="icon.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-messaging.js"></script>
  <style>
    body {
      font-family: Arial, Helvetica, sans-serif;
      padding: 20px;
    }

    .dark-mode {
      background-color: #000;
      color: white;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
    }

    td,
    th {
      border: 1px solid #000;
      padding: 4px;
      font-size: 12px;
    }

    button {
      margin-top: 10px;
    }
  </style>
</head>

<body>
  <div class=" flex h-16"></div>
  <div class="flex-1 p-6 max-w-2xl mx-auto">
    <h1 class="text-4xl font-bold text-center">√Ålv√°nyos szolg√°lat</h1>
    <button id="previous"
      class="block mx-auto mt-4 px-7 py-2 bg-cyan-700 text-white rounded-lg hover:bg-cyan-800 transition"
      onclick="window.open('ellozo.html', '_self')">-</button>
    <button id="current"
      class="block mx-auto mt-4 px-7 py-2 bg-cyan-700 text-white rounded-lg hover:bg-cyan-800 transition"
      onclick="window.open('mostani.html', '_self')">-</button>
    <button id="upcoming"
      class="block mx-auto mt-4 px-7 py-2 bg-cyan-700 text-white rounded-lg hover:bg-cyan-800 transition"
      onclick="window.open('kovetkezo.html', '_self')">-</button>
    <button id="darkMode"
      class="block mx-auto mt-4 px-7 py-2 bg-cyan-700 text-white rounded-lg hover:bg-cyan-800 transition">S√∂t√©t</button>
  </div>


  <script>
    const endpoint = "https://ferlaty.github.io/alvanyos-szolgalat-app/data.json";

    async function updateButtons() {
      try {
        const response = await fetch(endpoint);
        if (!response.ok) throw new Error("Network response failed");

        const data = await response.json();

        // Loop through all buttons in JSON
        data.buttons.forEach(btn => {
          const button = document.getElementById(btn.id);
          if (button) {
            button.textContent = btn.value;
          }
        });
      } catch (error) {
        console.error("Failed to fetch button data:", error);
      }
    }

    window.addEventListener("DOMContentLoaded", updateButtons);
  </script>

  <script>
    const element = document.body;
    const btn = document.getElementById("darkMode");

    // Load saved mode
    if (localStorage.getItem("Mode") === "dark") {
      element.classList.add("dark-mode");
      btn.textContent = "Vil√°gos";
    }

    btn.addEventListener("click", function () {
      const isDark = element.classList.toggle("dark-mode"); // true if now dark

      if (isDark) {
        localStorage.setItem("Mode", "dark");
        btn.textContent = "Vil√°gos";
      } else {
        localStorage.setItem("Mode", "light");
        btn.textContent = "S√∂t√©t";
      }
    });
  </script>
  <script>
    // üî• Step 1: Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCUuzbpOeZOFHxrFzL3gijeKtRw9e_veHM",
      authDomain: "alvanyos-szolgalat.firebaseapp.com",
      projectId: "alvanyos-szolgalat",
      storageBucket: "alvanyos-szolgalat.firebasestorage.app",
      messagingSenderId: "1037601102689",
      appId: "1:1037601102689:web:e4f22b9df0f8360f6d4320",
      measurementId: "G-K0WNX1LH9J"
    };
    firebase.initializeApp(firebaseConfig);

    // üî• Step 2: Initialize Messaging
    const messaging = firebase.messaging();

    // üî• Step 3: Register service worker
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/firebase-messaging-sw.js")
        .then((registration) => {
          console.log("Service Worker registered:", registration);

          // üî• Step 4: Get permission for notifications
          Notification.requestPermission().then((permission) => {
            if (permission === "granted") {
              console.log("Notification permission granted.");

              // üî• Step 5: Get FCM token
              messaging.getToken({
                vapidKey: "BHymTZNlOpi_K1Aqz1T86YsLpB0yk0bcgymzebhM2Uq65GivsquArPj6xfMBq4LqhCeyAqB9B3ag0ZGXMnCEeV4",
                serviceWorkerRegistration: registration
              })
                .then((currentToken) => {
                  if (currentToken) {
                    console.log("FCM Token:", currentToken);
                    alert("Your FCM token is in the console. Use it to send test messages from Firebase Console.");
                  } else {
                    console.log("No registration token available.");
                  }
                })
                .catch((err) => console.error("Token error:", err));
            } else {
              console.log("Notification permission denied.");
            }
          });
        })
        .catch((err) => console.error("Service Worker registration failed:", err));
    }

    // üî• Step 6: Handle messages while the site is open
    messaging.onMessage((payload) => {
      console.log("Message received in foreground: ", payload);
      alert(`Foreground message: ${payload.notification.title}`);
    });
  </script>

</body>